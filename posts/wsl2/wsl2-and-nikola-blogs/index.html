<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Getting Nikola working with WSL2">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>WSL2 and Nikola Blogs | RC Notebook</title>
<link href="../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=Playfair+Display:700,900" rel="stylesheet">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../../rss.xml">
<link rel="canonical" href="https://ravi-chandran.github.io/posts/wsl2/wsl2-and-nikola-blogs/">
<!--[if lt IE 9]><script src="../../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Ravi Chandran">
<link rel="prev" href="../../git/git-setup-in-5-minutes/" title="Git setup in 5 minutes" type="text/html">
<meta property="og:site_name" content="RC Notebook">
<meta property="og:title" content="WSL2 and Nikola Blogs">
<meta property="og:url" content="https://ravi-chandran.github.io/posts/wsl2/wsl2-and-nikola-blogs/">
<meta property="og:description" content="Getting Nikola working with WSL2">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2020-07-10T10:48:30-04:00">
<meta property="article:tag" content="Blogs">
<meta property="article:tag" content="Linux">
<meta property="article:tag" content="Nikola">
<meta property="article:tag" content="Windows">
<meta property="article:tag" content="WSL">
<meta property="article:tag" content="WSL2">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Header and menu bar -->
<div class="container">
      <header class="blog-header py-3"><div class="row nbb-header align-items-center">
          <div class="col-md-3 col-xs-2 col-sm-2" style="width: auto;">
            <button class="navbar-toggler navbar-light bg-light nbb-navbar-toggler" type="button" data-toggle="collapse" data-target=".bs-nav-collapsible" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse bs-nav-collapsible bootblog4-search-form-holder">
                
            </div>
        </div>
          <div class="col-md-6 col-xs-10 col-sm-10 bootblog4-brand" style="width: auto;">
            <a class="navbar-brand blog-header-logo text-dark" href="https://ravi-chandran.github.io/">
            <img src="../../../images/rcnotebooksmall.png" alt="RC Notebook" id="logo" class="d-inline-block align-top"></a>
          </div>
            <div class="col-md-3 justify-content-end align-items-center bs-nav-collapsible collapse flex-collapse bootblog4-right-nav">
            <nav class="navbar navbar-light bg-white"><ul class="navbar-nav bootblog4-right-nav">
<li class="nav-item">
    <a href="index.md" id="sourcelink" class="nav-link">Source</a>
    </li>


                    
            </ul></nav>
</div>
    </div>
</header><nav class="navbar navbar-expand-md navbar-light bg-white static-top"><div class="collapse navbar-collapse bs-nav-collapsible" id="bs-navbar">
            <ul class="navbar-nav nav-fill d-flex w-100">
<li class="nav-item">
<a href="../../../archive.html" class="nav-link">Archive</a>
                </li>
<li class="nav-item">
<a href="../../../categories/" class="nav-link">Tags</a>
                </li>
<li class="nav-item">
<a href="../../../rss.xml" class="nav-link">RSS feed</a>

                
            </li>
</ul>
</div>
<!-- /.navbar-collapse -->
</nav>
</div>

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        
        
        
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">WSL2 and Nikola Blogs</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    Ravi Chandran
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2020-07-10T10:48:30-04:00" itemprop="datePublished" title="2020-07-10">2020-07-10</time></a>
            </p>
                <p class="commentline">
        
    <a href="#disqus_thread" data-disqus-identifier="cache/posts/wsl2/wsl2-and-nikola-blogs.html">Comments</a>


            
        </p>
<p class="sourceline"><a href="index.md" class="sourcelink">Source</a></p>

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div>
<p>After switching to WSL2 as explained in a <a href="../straddling-windows-and-linux/">previous post</a>, while <code>terminator</code> and <code>code</code> were working fine, something broke with my blogging workflow.</p>
<p>When <code>nikola serve -b</code> is executed from <code>bash</code>, it should launch a web browser and serve the blog locally for review. But this does not work under WSL2 without some adjustments.</p>
<!-- TEASER_END -->

<p>X11 forwarding is necessary and can be set up using the VcXsrv application as explained in the <a href="../straddling-windows-and-linux/">previous post</a>.</p>
<p>After VcXsrv is set up, there are a few additions to <code>~/.bashrc</code> needed.</p>
<h3>X11 Forwarding <code>DISPLAY</code> IP Address</h3>
<p>WSL2 is a VM that uses a virtual network switch to connect the VM to Windows 10. 
To use X11 forwarding with WSL2, the <code>DISPLAY</code> environment variable cannot point to the usual localhost or 127.0.0.1 IP. Instead, <code>DISPLAY</code> must point to the Windows 10 machine's IP address on the virtual network switch. This IP address can be found on the Windows 10 Ethernet adapter that looks the following under Windows:</p>
<p><img alt="" src="../../../images/wsl2/vEthernet_WSL.png"></p>
<p>Unfortunately, this IP seems to change on each boot. But luckily, <code>/etc/resolv.conf</code> has this Windows 10 machine's IP address indicated as the <code>nameserver</code>. We can grab this IP and set it to the <code>DISPLAY</code> variable by adding the following one-liner to <code>~/.bashrc</code>:</p>
<pre class="code literal-block"><span></span><code><span class="nb">export</span> <span class="nv">DISPLAY</span><span class="o">=</span><span class="k">$(</span>cat /etc/resolv.conf <span class="p">|</span> grep nameserver <span class="p">|</span> awk <span class="s1">'{print $2}'</span><span class="k">)</span>:0.0
</code></pre>


<h3>Setting A Default Browser</h3>
<p>Under WSL2, the <code>BROWSER</code> variable is empty by default. Nikola seems to try multiple browsers when <code>nikola serve -b</code> is invoked, but none of them work since I did not install any browser under WSL2. Adding the following to <code>~/.bashrc</code> fixes this problem. In this example, I'm setting the default browser to Google Chrome under Windows.</p>
<pre class="code literal-block"><span></span><code><span class="nb">export</span> <span class="nv">BROWSER</span><span class="o">=</span><span class="s1">'/mnt/c/Program Files (x86)/Google/Chrome/Application/chrome.exe'</span>
</code></pre>


<h3>Nikola Must Serve On <code>eth0</code>
</h3>
<p>By default, Nikola serves on 127.0.0.1. However, this address inside the WSL2 VM is independent of the identical address on the Windows side. The connection between the WSL2 VM and the Windows 10 side is via a virtual network switch. Instead of serving on 127.0.0.1, if we served on the IPv4 address corresponding to the WSL2's <code>eth0</code> network adapter, then the browser on the Windows side can access the Nikola server through the virtual network switch. Nikola has the <code>-addr=</code> or <code>-a</code> option to specify the IPv4 address to use instead of 127.0.0.1. </p>
<p>To automate this, we add the following line to <code>~/.bashrc</code> to get the <code>eth0</code> IPv4 address and save it for use with Nikola:</p>
<pre class="code literal-block"><span></span><code><span class="nb">export</span> <span class="nv">MYIPADDR</span><span class="o">=</span><span class="k">$(</span>ifconfig eth0 <span class="p">|</span> grep <span class="s1">'inet '</span> <span class="p">|</span> awk <span class="s1">'{print $2}'</span><span class="k">)</span>
</code></pre>


<p>With the above changes to <code>~/.bashrc</code> and sourcing it again, we can invoke Nikola as follows to serve the blog locally on the Windows-side browser:</p>
<pre class="code literal-block"><span></span><code>nikola serve -b -a <span class="nv">$MYIPADDR</span>
<span class="c1"># nikola auto -b -a $MYIPADDR   # alternate option</span>
</code></pre>


<h3>Sync Between Windows and Nikola</h3>
<p>When using <code>nikola auto -b -a $MYIPADDR</code>, Nikola is expected to continuously update the served page as I edit and save. However, WSL2 doesn't seem to notice changes occurring on the Windows side. Need to explore this further another time...</p>
</div>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../../categories/blogs/" rel="tag">Blogs</a></li>
            <li><a class="tag p-category" href="../../../categories/linux/" rel="tag">Linux</a></li>
            <li><a class="tag p-category" href="../../../categories/nikola/" rel="tag">Nikola</a></li>
            <li><a class="tag p-category" href="../../../categories/windows/" rel="tag">Windows</a></li>
            <li><a class="tag p-category" href="../../../categories/wsl/" rel="tag">WSL</a></li>
            <li><a class="tag p-category" href="../../../categories/wsl2/" rel="tag">WSL2</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../../git/git-setup-in-5-minutes/" rel="prev" title="Git setup in 5 minutes">Previous post</a>
            </li>
        </ul></nav></aside><section class="comments hidden-print"><h2>Comments</h2>
        
        
        <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="rcnotebook",
            disqus_url="https://ravi-chandran.github.io/posts/wsl2/wsl2-and-nikola-blogs/",
        disqus_title="WSL2 and Nikola Blogs",
        disqus_identifier="cache/posts/wsl2/wsl2-and-nikola-blogs.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


        </section></article><script>var disqus_shortname="rcnotebook";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script><!--End of body content--><footer id="footer">
            Contents © 2020         <a href="mailto:">Ravi Chandran</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
<br><a rel="license" href="https://opensource.org/licenses/MIT">MIT License for Software, </a>
<a href="http://creativecommons.org/licenses/by/4.0/">Creative Commons License CC BY 4.0 for other items</a>

            
            
        </footer>
</div>
</div>


        <script src="../../../assets/js/all-nocdn.js"></script><script src="../../../assets/js/moment-with-locales.min.js"></script><!-- fancy dates --><script>
        moment.locale("en");
        fancydates(2, "YYYY-MM-DD HH:mm");
        </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script>
</body>
</html>
